{% extends "base.html" %}

{% block title %}RSS Feeds - Microblog{% endblock %}

{% block content %}
<div class="post-form">
    <h2>üì° RSS Feed Management</h2>
    <p style="color: #8a8d91; margin-bottom: 20px; font-size: 14px;">
        Add RSS feeds to easily share content from your favorite sources
    </p>
    
    <form method="POST" action="{{ url_for('add_rss') }}">
        <div class="form-group">
            <label for="url">RSS Feed URL *</label>
            <input type="text" name="url" id="url" required placeholder="https://example.com/feed.xml">
        </div>
        
        <div class="form-group">
            <label for="name">Feed Name (Optional)</label>
            <input type="text" name="name" id="name" placeholder="My Favorite Blog">
            <small>Give this feed a memorable name</small>
        </div>
        
        <div class="checkbox-group">
            <label>
                <input type="checkbox" name="auto_queue" id="auto_queue" onchange="toggleAutoPostMode()">
                Automatically process new entries
            </label>
        </div>
        <small style="color: #8a8d91; display: block; margin-top: 4px; margin-bottom: 16px;">
            When enabled, new entries from this feed will be automatically processed
        </small>
        
        <div id="auto_post_mode_section" style="display: none; margin-bottom: 20px;">
            <label for="auto_post_mode">Auto-post behavior:</label>
            <select name="auto_post_mode" id="auto_post_mode" style="width: 100%; padding: 10px; border: 1px solid #3a3d42; background: #1e2124; color: #dcddde; border-radius: 4px; margin-top: 8px;">
                <option value="queue">Add to Queue (manual posting)</option>
                <option value="social">Post to Socials Immediately</option>
                <option value="local">Post Locally Only (no socials)</option>
            </select>
            <small style="color: #8a8d91; display: block; margin-top: 4px;">
                Choose how new entries should be handled automatically
            </small>
        </div>
        
        <button type="submit" class="btn btn-primary">Add Feed</button>
    </form>
</div>

<div class="posts">
    <h2>Your RSS Feeds</h2>
    
    {% if feeds %}
        <div class="rss-feed-list">
            {% for feed in feeds %}
                <div class="rss-feed-item">
                    <div class="rss-feed-info">
                        <h3>
                            {{ feed.name or feed.url }}
                            {% if feed.auto_queue %}
                                {% set mode = feed.auto_post_mode or 'queue' %}
                                {% if mode == 'social' %}
                                    <span class="badge" style="background: #5865f2; margin-left: 8px;">üöÄ AUTO-POST SOCIAL</span>
                                {% elif mode == 'local' %}
                                    <span class="badge" style="background: #4a9d5f; margin-left: 8px;">üìù AUTO-POST LOCAL</span>
                                {% else %}
                                    <span class="badge" style="background: #f26522; margin-left: 8px;">üìã AUTO-QUEUE</span>
                                {% endif %}
                            {% endif %}
                        </h3>
                        {% if feed.name %}
                            <p class="rss-feed-url">{{ feed.url }}</p>
                        {% endif %}
                        {% if feed.auto_queue %}
                            {% set mode = feed.auto_post_mode or 'queue' %}
                            <p style="color: #8a8d91; font-size: 13px; margin-top: 4px;">
                                {% if mode == 'social' %}
                                    ‚ú® New entries will be posted to social media automatically
                                {% elif mode == 'local' %}
                                    üìö New entries will be saved locally (no social posting)
                                {% else %}
                                    ‚è≥ New entries will be added to queue for manual posting
                                {% endif %}
                            </p>
                        {% endif %}
                    </div>
                    <div class="rss-feed-actions">
                        <form method="POST" action="{{ url_for('toggle_rss_auto_queue', feed_id=feed.id) }}" style="display: inline;">
                            <button type="submit" class="btn" style="background: {% if feed.auto_queue %}#e4405f{% else %}#4a9d5f{% endif %}; color: white;">
                                {% if feed.auto_queue %}Disable Auto{% else %}Enable Auto{% endif %}
                            </button>
                        </form>
                        {% if feed.auto_queue %}
                            <form method="POST" action="{{ url_for('cycle_rss_auto_post_mode', feed_id=feed.id) }}" style="display: inline;">
                                {% set mode = feed.auto_post_mode or 'queue' %}
                                <button type="submit" class="btn btn-primary" title="Click to cycle through: Queue ‚Üí Social ‚Üí Local">
                                    {% if mode == 'social' %}
                                        üöÄ Social
                                    {% elif mode == 'local' %}
                                        üìù Local
                                    {% else %}
                                        üìã Queue
                                    {% endif %}
                                </button>
                            </form>
                        {% endif %}
                        <a href="{{ url_for('browse_rss', feed_id=feed.id) }}" class="btn btn-primary">Browse</a>
                        <form method="POST" action="{{ url_for('delete_rss', feed_id=feed.id) }}" style="display: inline;">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this feed?')">Delete</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="empty-state">
            No RSS feeds yet. Add one above to get started!
        </p>
    {% endif %}
</div>

<script>
function toggleAutoPostMode() {
    const autoQueueCheckbox = document.getElementById('auto_queue');
    const autoPostModeSection = document.getElementById('auto_post_mode_section');
    
    if (autoQueueCheckbox.checked) {
        autoPostModeSection.style.display = 'block';
    } else {
        autoPostModeSection.style.display = 'none';
    }
}

// Call on page load in case checkbox is pre-checked
document.addEventListener('DOMContentLoaded', toggleAutoPostMode);
</script>
{% endblock %}