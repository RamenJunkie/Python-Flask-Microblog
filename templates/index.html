{% extends "base.html" %}

{% block content %}
<div class="post-form">
    <h2>Create New Post</h2>
    <form method="POST" action="{{ url_for('create_post') }}" enctype="multipart/form-data">
        <div class="form-group">
            <label for="text">Text / Caption *</label>
            <textarea name="text" id="text" required placeholder="What's on your mind?"></textarea>
        </div>
        
        <div class="form-group">
            <label for="url">Link (Optional)</label>
            <input type="text" name="url" id="url" placeholder="https://example.com">
            <small>Add a URL to create a link post with preview</small>
        </div>
        
        <div class="form-group">
            <label for="image">Image (Optional)</label>
            <input type="file" name="image" id="image" accept="image/*">
            <small>Upload an image to attach to your post</small>
        </div>
        
        <div class="checkbox-group">
            <label>
                <input type="checkbox" name="post_now" id="post_now" checked>
                Post immediately (unchecked = add to queue)
            </label>
        </div>
        
        <div class="checkbox-group">
            <label>
                <input type="checkbox" name="local_only" id="local_only">
                Local only (don't share to Bluesky/Mastodon)
            </label>
        </div>
        
        <button type="submit" class="btn btn-primary">Post</button>
    </form>
</div>

<div class="posts">
    <h2>Archive</h2>
    
    <form method="GET" action="{{ url_for('index') }}" class="search-form">
        <input type="text" name="search" placeholder="Search posts..." value="{{ search }}">
        <button type="submit" class="btn btn-primary">Search</button>
        {% if search %}
            <a href="{{ url_for('index') }}" class="btn">Clear</a>
        {% endif %}
    </form>
    
    {% if entries %}
        {% for entry in entries %}
            <div class="post-entry">
                {% if entry.timestamp %}
                    <div class="timestamp">{{ entry.timestamp.strftime('%B %d, %Y at %I:%M %p') }}</div>
                {% endif %}
                
                {% set parsed = entry.content | parse_content %}
                
                <div class="content">
                    {{ parsed.text }}
                </div>
                
                {% if parsed.type == 'url' %}
                    <a href="{{ parsed.url }}" target="_blank" class="url">üîó {{ parsed.url }}</a>
                {% elif parsed.type == 'image' %}
                    <div class="post-entry-image">
                        <img src="/images/{{ parsed.image }}" alt="Post image" onerror="this.onerror=null; this.parentElement.innerHTML='<span class=\'image-ref\'>üñºÔ∏è {{ parsed.image }}</span>';">
                    </div>
                {% endif %}
            </div>
        {% endfor %}
        
        {% if pagination.total_pages > 1 %}
            <div class="pagination">
                {% if pagination.page > 1 %}
                    <a href="{{ url_for('index', page=pagination.page-1, search=search) }}">‚Üê Previous</a>
                {% endif %}
                
                {% for p in range(1, pagination.total_pages + 1) %}
                    {% if p == pagination.page %}
                        <span class="pagination-link current">{{ p }}</span>
                    {% elif p == 1 or p == pagination.total_pages or (p >= pagination.page - 2 and p <= pagination.page + 2) %}
                        <a href="{{ url_for('index', page=p, search=search) }}">{{ p }}</a>
                    {% elif p == pagination.page - 3 or p == pagination.page + 3 %}
                        <span>...</span>
                    {% endif %}
                {% endfor %}
                
                {% if pagination.page < pagination.total_pages %}
                    <a href="{{ url_for('index', page=pagination.page+1, search=search) }}">Next ‚Üí</a>
                {% endif %}
            </div>
        {% endif %}
    {% else %}
        <p class="empty-state">
            {% if search %}
                No posts found matching "{{ search }}"
            {% else %}
                No posts yet. Create your first post above!
            {% endif %}
        </p>
    {% endif %}
</div>
{% endblock %}